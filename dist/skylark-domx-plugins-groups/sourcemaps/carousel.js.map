{"version":3,"sources":["carousel.js"],"names":["define","langx","browser","eventer","$","elmx","plugins","groups","Group","Indicators","EffectSlide","effects","slide","Carousel","inherit","klassName","pluginName","options","cycle","interval","pause","wrap","keyboard","controls","selectors","toggle","prev","next","close","playPause","indicators","indicator","template","indexAttrName","itemsContainer","indicatorsContainer","item","selector","classes","base","effect","startIndex","rotate","coverflow","onjumped","onjumping","_construct","elm","prototype","call","this","selectable","multiSelect","_$elm","_$itemsContainer","find","$indicators","length","_indicators","mixin","carousel","active","setActiveIndicator","paused","moving","$active","on","proxy","keydown","document","documentElement","e","stop","_effect","items","addItems","jump","test","target","tagName","which","preventDefault","cycling","isDefined","cycled","clearInterval","setInterval","getItemForDirection","direction","activeIndex","getItemIndex","_$items","itemIndex","eq","pos","that","activeItem","getActiveItem","one","pausing","isUndefined","index","getItemsCount","i","addItem","resetItems","itemData","itemHtml","renderItemHtml","baseClass","$item","addClass","append","addIndicator","register"],"mappings":"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","file":"../carousel.js","sourcesContent":[" define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-domx-browser\",\r\n  \"skylark-domx-eventer\",\r\n  \"skylark-domx-query\",\r\n  \"skylark-domx-velm\",\r\n  \"skylark-domx-plugins-base\",\r\n  \"./groups\",\r\n  \"./group\",\r\n  \"./_carousel/indicators\",\r\n  \"./_carousel/effect_slide\"\r\n],function(langx,browser,eventer,$,elmx,plugins,groups,Group,Indicators,EffectSlide){\r\n  'use strict'\r\n\r\n  var effects = {\r\n    \"slide\" : EffectSlide\r\n  };\r\n \r\n  var Carousel = Group.inherit({\r\n    klassName : \"Carousel\",\r\n\r\n    pluginName : \"lark.groups.carousel\",\r\n\r\n        options : {\r\n            cycle : {\r\n              // [milliseconds]\r\n              // If a positive number, Carousel will automatically advance to next item after that number of milliseconds\r\n              interval: 5000,\r\n\r\n              pause: 'hover'        \r\n            },\r\n\r\n            wrap: true,\r\n            keyboard: true,\r\n\r\n            controls : {\r\n              selectors : {\r\n               // The class for the \"toggle\" control:\r\n                toggle: '.toggle',\r\n                // The class for the \"prev\" control:\r\n                prev: '.prev',\r\n                // The class for the \"next\" control:\r\n                next: '.next',\r\n                // The class for the \"close\" control:\r\n                close: '.close',\r\n                // The class for the \"play-pause\" toggle control:\r\n                playPause: '.play-pause'\r\n              }\r\n            },\r\n\r\n            indicators : {\r\n                indicator : {\r\n                  template : \"<li/>\",\r\n                  indexAttrName : \"data-index\"\r\n                },\r\n\r\n            },\r\n\r\n            selectors :{\r\n              itemsContainer : \".items\",\r\n              indicatorsContainer : \".indicators\"\r\n            },\r\n\r\n            item : {\r\n              selector : \".item\",\r\n              classes : {\r\n                base : \"item\"\r\n              }\r\n            },\r\n\r\n            //items : \".carousel-item\",  // the items are from dom elements\r\n            //items : [{                 // the items are from json object\r\n            //  type: 'image',href : \"https://xxx.com/1.jpg\",title : \"1\"\r\n            //},{\r\n            //  type: 'image',href : \"https://xxx.com/1.jpg\",title : \"1\"\r\n            // }],\r\n\r\n\r\n            effect : \"slide\",\r\n\r\n            startIndex : 0,\r\n\r\n            effects : {\r\n              slide : {\r\n                classes : {\r\n                  base : \"slide\"\r\n                }\r\n              },\r\n\r\n              rotate : {\r\n                classes : {\r\n                  base : \"rotate\"\r\n                }\r\n              },\r\n\r\n              coverflow : {\r\n                classes : {\r\n                  base : \"coverflow\"\r\n                }\r\n              }\r\n            },\r\n\r\n            onjumped : null,\r\n            onjumping : null\r\n        },\r\n\r\n        _construct: function(elm, options) {\r\n            //this.options = options\r\n            Group.prototype._construct.call(this,elm,options);\r\n\r\n            this.options.item.selectable = true;\r\n            this.options.item.multiSelect = false;\r\n\r\n\r\n            this._$elm = this.$();\r\n            this._$itemsContainer = this._$elm.find(this.options.selectors.itemsContainer);\r\n            \r\n            let $indicators = this._$elm.find(this.options.selectors.indicatorsContainer); \r\n            if ($indicators.length>0) {\r\n              this._indicators = new Indicators($indicators[0],langx.mixin({\r\n                carousel : this,\r\n                active : 0\r\n              },this.options.indicators));\r\n              this._indicators.setActiveIndicator(0);\r\n            }\r\n\r\n\r\n\r\n            this.paused = null;\r\n            this.moving = null;\r\n            this.interval = null;\r\n            this.$active = null;\r\n\r\n            if (this.options.cycle.interval >0) {\r\n              this.cycle(true);\r\n            } else {\r\n              this.cycle(false);\r\n            }\r\n\r\n            var self = this;\r\n            this.options.keyboard && this._$elm.on('keydown.lark.carousel', langx.proxy(this.keydown, this))\r\n\r\n            this.options.cycle.pause == 'hover' && !('ontouchstart' in document.documentElement) && this._$elm\r\n                .on('mouseenter.lark.carousel', (e) => {\r\n                  this.pause(true);\r\n                }).on('mouseleave.lark.carousel', (e) => {\r\n                  this.pause(false)\r\n                });\r\n\r\n            this._$elm.find(this.options.controls.selectors.prev).on(\"click\",(e)=>{\r\n                this.prev();\r\n                eventer.stop(e);\r\n            });\r\n\r\n            this._$elm.find(this.options.controls.selectors.next).on(\"click\",(e)=>{\r\n                this.next();\r\n                eventer.stop(e);\r\n            });\r\n\r\n            this._effect = new effects[this.options.effect](this);\r\n\r\n            if (this.options.items) {\r\n                this.addItems(this.options.items);\r\n                this.jump(this.options.startIndex)\r\n            }\r\n\r\n            if (this.options.onjumped) {\r\n              this.on(\"jumped\",this.options.onjumped)\r\n            }\r\n\r\n            if (this.options.onjumping) {\r\n              this.on(\"jumping\",this.options.onjumping)\r\n            }\r\n        },\r\n\r\n        keydown : function(e) {\r\n            if (/input|textarea/i.test(e.target.tagName)) return\r\n            switch (e.which) {\r\n                case 37:\r\n                    this.prev();\r\n                    break\r\n                case 39:\r\n                    this.next();\r\n                    break\r\n                default:\r\n                    return\r\n            }\r\n\r\n            e.preventDefault()\r\n        },\r\n\r\n\r\n        /*\r\n         * Cycles through the carousel items from left to right.\r\n         */\r\n        cycle : function(cycling) {\r\n            if (langx.isDefined(cycling)) {\r\n              this.cycled = !!cycling;\r\n             ///  e || (this.paused = false)\r\n            }\r\n\r\n            if (this.interval){\r\n              clearInterval(this.interval);\r\n            }\r\n\r\n            if (this.options.cycle.interval && this.cycled && !this.paused ) {\r\n                this.interval = setInterval(langx.proxy(this.next, this), this.options.cycle.interval);\r\n            }\r\n\r\n            return this;\r\n        },\r\n\r\n        getItemForDirection : function(direction, active) {\r\n            var activeIndex = this.getItemIndex(active)\r\n            var willWrap = (direction == 'prev' && activeIndex === 0) ||\r\n                (direction == 'next' && activeIndex == (this._$items.length - 1))\r\n            if (willWrap && !this.options.wrap) return active\r\n            var delta = direction == 'prev' ? -1 : 1\r\n            var itemIndex = (activeIndex + delta) % this._$items.length\r\n            return this._$items.eq(itemIndex);\r\n        },\r\n\r\n        /*\r\n         *Cycles the carousel to a particular frame (0 based, similar to an array). Returns to the caller before the target item has been shown\r\n         */\r\n        jump : function(pos) {\r\n            var that = this;\r\n\r\n            var activeItem = this.getActiveItem(),\r\n                activeIndex = activeItem ? this.getItemIndex(activeItem) : -1;\r\n\r\n            if (pos > (this._$items.length - 1) || pos < 0) return\r\n\r\n            if (this.moving) return this._$elm.one('jumped.lark.carousel', function() { that.jump(pos) }) // yes, \"slid\"\r\n            if (activeIndex == pos)  return this.pause().cycle()\r\n\r\n            return this._effect.jump(pos > activeIndex ? 'next' : 'prev', this._$items.eq(pos))\r\n        },\r\n\r\n        /*\r\n         * Stops the carousel from cycling through items.\r\n         */\r\n        pause : function(pausing) {\r\n            if (langx.isUndefined(pausing)) {\r\n              pausing = true;\r\n            }\r\n            this.paused = !!pausing;\r\n\r\n            ///e || (this.paused = true)\r\n\r\n            ///if (this._$elm.find(this.options.controls.selectors.next + \",\"+ this.options.controls.selectors.prev).length) { //.next,.prev\r\n                ///this._$elm.trigger(browser.support.transition.end)\r\n                ///this.cycle(true)\r\n            ///}\r\n\r\n            ///this.interval = clearInterval(this.interval)\r\n            this.cycle();\r\n\r\n            return this\r\n        },\r\n\r\n        /*\r\n         * Cycles to the next item. Returns to the caller before the next item has been shown\r\n         */\r\n        next : function() {\r\n            if (this.moving) {\r\n              return\r\n            }\r\n            return this._effect.jump('next')\r\n        },\r\n\r\n        /*\r\n         * Cycles to the previous item. Returns to the caller before the previous item has been shown.\r\n         */\r\n        prev : function() {\r\n           if (this.moving) return\r\n            return this._effect.jump('prev')\r\n        },\r\n\r\n\r\n        addItems : function(items) {\r\n            let index = this.getItemsCount();\r\n            for (var i=0; i<items.length;i++) {\r\n              this.addItem(index++,items[i]);\r\n            }\r\n            this.resetItems();\r\n        },\r\n\r\n        addItem : function(index,itemData) {\r\n          let itemHtml = this.renderItemHtml(itemData),\r\n              baseClass = this.options.item.classes.base;\r\n\r\n\r\n          let $item = $(itemHtml);\r\n          if (baseClass) {\r\n            $item.addClass(baseClass);\r\n          }\r\n\r\n          if (this._$itemsContainer) {\r\n            this._$itemsContainer.append($item);\r\n          }\r\n          if (this._indicators) {\r\n            this._indicators.addIndicator(index,itemData);\r\n          }\r\n\r\n        }\r\n  });\r\n\r\n\r\n  plugins.register(Carousel);\r\n\r\n  return groups.Carousel = Carousel;\t\r\n});"]}